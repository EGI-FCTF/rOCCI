<%# Mandatory settings %>
OCCI_ID       = <%= compute.attributes["occi.core.id"]%>
NAME          = "<%= compute.attributes["occi.core.title"]%>"
DESCRIPTION   = "<%= compute.attributes['occi.core.summary'] 				if compute.attributes['occi.core.summary']%>"
MEMORY        = <%= compute.attributes["occi.compute.memory"].to_i * 1024	if compute.attributes["occi.compute.memory"]%>
VCPU          = <%= compute.attributes["occi.compute.cores"] 				if compute.attributes["occi.compute.cores"]%>

<% if compute.attributes["opennebula.vm.cpu_reservation"] %>
CPU        	  = <%= compute.attributes["opennebula.vm.cpu_reservation"] %>
<% else %>
CPU           = 0.01
<% end %>

<%# KVM specific settings %>
RAW = [TYPE = kvm]
OS = [
	<% if compute.attributes["occi.compute.architecture"] == "x64" %>
	ARCH = x86_64,
	<% else %>
	ARCH = i686,
	<% end %>

	<% if compute.attributes["opennebula.vm.boot"] %>
	BOOT          = <%= compute.attributes["opennebula.vm.boot"] if compute.attributes["opennebula.vm.boot"]%>
	<% else %>
	BOOT          = hd
	<% end %>
]

<%# Links to images %>
<% storage.each do |storage, link| %>
DISK          = [ 
	IMAGE_ID 	= "<%= storage.backend[:id] %>"
]
<%end%>

<%# Links to external storage %>
<% external_storage.each do |storage_URI| %>
DISK = [
  TYPE      	= "OS",
  SOURCE        = <%= storage_URI %>
]
<%end%>
   
<%# Links to networks %>
<% networks.each do |network, link| %>
NIC           = [ 
  <% "IP         = " + link.attributes["occi.networkinferface.address"] + "," 	if link.attributes["occi.networkinferface.address"]%>
  <% "MAC        = " + link.attributes["occi.networkinferface.mac"] + "," 		if link.attributes["occi.networkinferface.mac"]%>
  NETWORK_ID = <%= network.backend[:id] %>
]
<%end%>

<%# Haizea Reservation parameters %>
HAIZEA=	[	start 		=	"<%= compute.attributes["occi.reservation.start"] 		if compute.attributes["occi.reservation.start"]%>",
			duration 	= 	"<%= compute.attributes["occi.reservation.duration"] 	if compute.attributes["occi.reservation.duration"]%>",
			preemptible	= 	"<%= compute.attributes["occi.reservation.preemptible"] if compute.attributes["occi.reservation.preemptible"]%>" ]

<%# Custom settings %>
GRAPHICS   	= [ 
	TYPE	= vnc,
  	LISTEN	= 0.0.0.0
]
FEATURES	= [ acpi="yes" ]
RANK = FREECPU

<%# Contextualization settings %>

<%# NFS support  %>

<% if $nfs_support %>
CONTEXT = [
	<% 
		if $nfs_support and not nfs_mounts.empty?
			i = 1
			nfs_mounts.each do |mount|
	%>
	
	<%= 		"NFS#{i}_EXPORT = #{mount[0]}," %>
	<%= 		"NFS#{i}_MOUNT  = #{mount[1]}," %>
	
	<%
			i += 1
			end
	%>
	<%= 		"NFSMOUNTS  = #{@nfs_mounts.length}" %>
			
	<% 	end %>
]
<% end %>
